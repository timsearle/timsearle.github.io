{% if page.slides %}
{% assign slide_folder = page.slides %}
{% assign slides_path = '/assets/slides/' | append: slide_folder %}

<div class="slides-container">
  <div class="slide-presentation">
    <div class="slide-viewer">
      <img id="current-slide" src="{{ slides_path }}/slide1.png" alt="Slide 1" />
    </div>
    
    <div class="slide-controls">
      <button id="prev-slide" class="slide-btn" disabled>← Previous</button>
      <span class="slide-counter">
        <span id="current-slide-num">1</span> / <span id="total-slides">{{ site.static_files | where: "path", slides_path | size }}</span>
      </span>
      <button id="next-slide" class="slide-btn">Next →</button>
    </div>
    
    <div class="slide-slider-container">
      <input type="range" id="slide-slider" class="slide-slider" min="1" max="144" value="1" />
    </div>
  </div>
  
  <div class="slide-instructions">
    <p><em>Use the Previous/Next buttons, slider, or your keyboard arrow keys to navigate through the presentation.</em></p>
  </div>
</div>

<script>
(function() {
  const slideFolder = '{{ slide_folder }}';
  const slidesPath = '{{ slides_path }}';
  let currentSlide = 1;
  
  // Count slides by checking what files exist
  let totalSlides = 0;
  const testSlide = (num) => {
    const img = new Image();
    img.onload = () => totalSlides = Math.max(totalSlides, num);
    img.src = `${slidesPath}/slide${num}.png`;
  };
  
  // Test up to 200 slides to find the actual count
  for (let i = 1; i <= 200; i++) {
    testSlide(i);
  }
  
  // Get DOM elements first
  const currentSlideImg = document.getElementById('current-slide');
  const currentSlideNum = document.getElementById('current-slide-num');
  const prevBtn = document.getElementById('prev-slide');
  const nextBtn = document.getElementById('next-slide');
  const slideSlider = document.getElementById('slide-slider');
  
  // Set a reasonable default and update when we know better
  totalSlides = 144; // Based on your demystifying-git folder
  document.getElementById('total-slides').textContent = totalSlides;
  slideSlider.max = totalSlides;
  
  function updateSlide() {
    currentSlideImg.src = `${slidesPath}/slide${currentSlide}.png`;
    currentSlideImg.alt = `Slide ${currentSlide}`;
    currentSlideNum.textContent = currentSlide;
    slideSlider.value = currentSlide;
    
    prevBtn.disabled = currentSlide === 1;
    nextBtn.disabled = currentSlide === totalSlides;
  }
  
  prevBtn.addEventListener('click', () => {
    if (currentSlide > 1) {
      currentSlide--;
      updateSlide();
    }
  });
  
  nextBtn.addEventListener('click', () => {
    if (currentSlide < totalSlides) {
      currentSlide++;
      updateSlide();
    }
  });
  
  slideSlider.addEventListener('input', (e) => {
    currentSlide = parseInt(e.target.value);
    updateSlide();
  });
  
  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.target.tagName.toLowerCase() === 'input' || e.target.tagName.toLowerCase() === 'textarea') {
      return; // Don't interfere with form inputs
    }
    
    if (e.key === 'ArrowLeft' && currentSlide > 1) {
      currentSlide--;
      updateSlide();
    } else if (e.key === 'ArrowRight' && currentSlide < totalSlides) {
      currentSlide++;
      updateSlide();
    }
  });
})();
</script>

<style>
.slides-container {
  margin: 2rem 0;
  text-align: center;
}

.slide-presentation {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 1rem;
  background: #f9f9f9;
}

.slide-viewer {
  margin-bottom: 1rem;
}

.slide-viewer img {
  max-width: 100%;
  height: auto;
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.slide-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
}

.slide-btn {
  padding: 0.5rem 1rem;
  border: 1px solid #ccc;
  background: white;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
}

.slide-btn:hover:not(:disabled) {
  background: #f0f0f0;
}

.slide-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.slide-counter {
  font-size: 0.9rem;
  color: #666;
  min-width: 60px;
}

.slide-slider-container {
  margin-top: 1rem;
  padding: 0 1rem;
}

.slide-slider {
  width: 100%;
  height: 8px;
  border-radius: 4px;
  background: #ddd;
  outline: none;
  opacity: 0.7;
  transition: opacity 0.2s;
}

.slide-slider:hover {
  opacity: 1;
}

.slide-slider::-webkit-slider-thumb {
  appearance: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #4CAF50;
  cursor: pointer;
}

.slide-slider::-moz-range-thumb {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #4CAF50;
  cursor: pointer;
  border: none;
}

.slide-instructions {
  margin-top: 1rem;
  text-align: center;
  color: #666;
  font-size: 0.9rem;
}

@media (max-width: 600px) {
  .slide-controls {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .slide-slider-container {
    padding: 0;
  }
}
</style>
{% endif %}